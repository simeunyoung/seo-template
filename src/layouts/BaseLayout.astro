---
import SEO from "../components/SEO.astro";
import Footer from "../components/Footer.astro";
import SiteHeader from "../components/SiteHeader.astro";
import ContactCTA from "../components/ContactCTA.astro";
import { SITE_URL } from "../consts/site";
import "../styles/global.css";

const {
  title = "사이트명",
  description = "설명",
  canonical = SITE_URL,
  ogImage = "/assets/images/logo.png",
  jsonLd = [],
} = Astro.props;

const GA_ID = import.meta.env.PUBLIC_GA_ID;

const gaInline = GA_ID
  ? `
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', '${GA_ID}', { anonymize_ip: true });
`
  : "";

  const siteName = "사이트명"; // 실제 브랜드/업장명으로 고정
  const orgJsonLd = {
    "@context": "https://schema.org",
    "@type": "Organization",
    name: siteName,
    url: SITE_URL,
    logo: new URL(ogImage, SITE_URL).toString(),
  };

  const websiteJsonLd = {
    "@context": "https://schema.org",
    "@type": "WebSite",
    name: siteName,
    url: SITE_URL,
  };
---
<!doctype html>
<html lang="ko">
  <head>
    <SEO title={title} description={description} canonical={canonical} ogImage={ogImage} />

    <script type="application/ld+json" set:html={JSON.stringify(orgJsonLd)} />
    <script type="application/ld+json" set:html={JSON.stringify(websiteJsonLd)} />
    {Array.isArray(jsonLd) &&
          jsonLd.map((obj) => (
            <script type="application/ld+json" set:html={JSON.stringify(obj)} />
      ))}

  </head>

  <body class="min-h-screen bg-[#1f2122] text-zinc-100">
    <SiteHeader />

    <main class="cy-container">
      <div class="rounded-2xl bg-[#27292a] mt-6 sm:mt-8 lg:mt-12 mb-8 sm:mb-10 lg:mb-14 p-5 sm:p-8 lg:p-14 shadow-[0_0_0_1px_rgba(255,255,255,0.06)]">
        <slot />
      </div>
    </main>

    <Footer />

    <ContactCTA />

    {GA_ID && (
      <>
        <script async src={`https://www.googletagmanager.com/gtag/js?id=${GA_ID}`}></script>
        <script is:inline set:html={gaInline}></script>
      </>
    )}
  </body>
</html>